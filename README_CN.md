# unplugin-devpilot

ä¸€ä¸ªé€šç”¨çš„å¼€å‘å·¥å…·æ’ä»¶æ¡†æ¶ï¼Œå®ç°æ— ç¼çš„æµè§ˆå™¨-æœåŠ¡å™¨é€šä¿¡å’Œ MCP (Model Context Protocol) ä¸ AI/LLM ç³»ç»Ÿçš„é›†æˆã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”Œ **é€šç”¨æ’ä»¶ç³»ç»Ÿ** - ä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„ä½¿ç”¨
- ğŸŒ **å¤šæ„å»ºå·¥å…·æ”¯æŒ** - é€šè¿‡ [unplugin](https://github.com/unjs/unplugin) æ”¯æŒ Viteã€Webpackã€Rspackã€Farm ç­‰
- ğŸ”„ **å®æ—¶åŒå‘é€šä¿¡** - åŸºäº WebSocket çš„æµè§ˆå™¨ä¸å¼€å‘æœåŠ¡å™¨é—´çš„åŒå‘ RPC é€šä¿¡
- ğŸ¤– **MCP é›†æˆ** - å†…ç½® Model Context Protocol æœåŠ¡å™¨ï¼Œæ”¯æŒ AI/LLM è‡ªåŠ¨åŒ–
- ğŸ¯ **DOM æ£€æŸ¥å™¨æ’ä»¶** - å¼€ç®±å³ç”¨çš„ DOM æ£€æŸ¥å’Œæ“æ§èƒ½åŠ›ï¼Œç”¨äºç½‘é¡µè‡ªåŠ¨åŒ–
- ğŸ› ï¸ **ä»…å¼€å‘æ¨¡å¼** - é›¶ç”Ÿäº§ç¯å¢ƒå¼€é”€ï¼Œä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œ

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
npm install -D unplugin-devpilot
npm install -D devpilot-plugin-dom-inspector
```

### é…ç½®

<details>
<summary><b>Vite</b></summary>

```ts
import DomInspector from 'devpilot-plugin-dom-inspector';
import Devpilot from 'unplugin-devpilot/vite';
// vite.config.ts
import { defineConfig } from 'vite';

export default defineConfig({
  plugins: [
    Devpilot({
      plugins: [DomInspector],
    }),
  ],
});
```

</details>

<details>
<summary><b>Webpack</b></summary>

```js
import DomInspector from 'devpilot-plugin-dom-inspector';
// webpack.config.js
import Devpilot from 'unplugin-devpilot/webpack';

export default {
  plugins: [
    Devpilot({
      plugins: [DomInspector],
    }),
  ],
};
```

</details>

<details>
<summary><b>Rspack</b></summary>

```ts
import DomInspector from 'devpilot-plugin-dom-inspector';
// rspack.config.ts
import Devpilot from 'unplugin-devpilot/rspack';

export default {
  plugins: [
    Devpilot({
      plugins: [DomInspector],
    }),
  ],
};
```

</details>

## åŒ…ä»‹ç»

### [unplugin-devpilot](./packages/unplugin-devpilot)

æ ¸å¿ƒæ’ä»¶æ¡†æ¶ï¼Œæä¾›ï¼š
- é€šè¿‡ unplugin æ”¯æŒå¤šä¸ªæ„å»ºå·¥å…·
- WebSocket æœåŠ¡å™¨ç”¨äºæµè§ˆå™¨-æœåŠ¡å™¨é€šä¿¡
- MCP æœåŠ¡å™¨ç”¨äº AI/LLM é›†æˆ
- å¸¦å‘½åç©ºé—´éš”ç¦»çš„æ’ä»¶ç³»ç»Ÿ
- å®¢æˆ·ç«¯ä»£ç çš„è™šæ‹Ÿæ¨¡å—ç”Ÿæˆ

**é»˜è®¤ç«¯å£ï¼š**
- WebSocket: 3100
- MCP: 3101

### [devpilot-plugin-dom-inspector](./packages/devpilot-plugin-dom-inspector)

å†…ç½®çš„ DOM æ£€æŸ¥æ’ä»¶ï¼Œæä¾›ï¼š
- ä¼˜åŒ– LLM token ä½¿ç”¨çš„ç´§å‡‘ DOM å¿«ç…§
- é€šè¿‡ devpilot-id æˆ– CSS é€‰æ‹©å™¨æŸ¥è¯¢å…ƒç´ 
- å…ƒç´ äº¤äº’åŠŸèƒ½ï¼ˆç‚¹å‡»ã€è¾“å…¥æ–‡æœ¬ï¼‰
- è§†è§‰å¸ƒå±€åˆ†æ
- æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—è®¿é—®
- 8 ä¸ªç”¨äºç½‘é¡µè‡ªåŠ¨åŒ–çš„ MCP å·¥å…·

**MCP å·¥å…·ï¼š**
- `query_selector` - æŸ¥è¯¢ DOM å…ƒç´ 
- `get_compact_snapshot` - è·å– LLM å‹å¥½çš„ DOM ç»“æ„
- `click_element_by_id` - ç‚¹å‡»å…ƒç´ 
- `input_text_by_id` - å¡«å……è¡¨å•å­—æ®µ
- `get_element_info_by_id` - è·å–å…ƒç´ è¯¦æƒ…
- `get_dom_tree` - è·å–å®Œæ•´çš„å¯è®¿é—®æ€§æ ‘
- `get_logs` - è®¿é—®æµè§ˆå™¨æ—¥å¿—
- `get_layout` - åˆ†æè§†è§‰å¸ƒå±€å±‚çº§

## ä½¿ç”¨åœºæ™¯

### ç½‘é¡µè‡ªåŠ¨åŒ–
è‡ªåŠ¨åŒ–æµè§ˆå™¨äº¤äº’å’Œ DOM æ“æ§ï¼Œç”¨äºæµ‹è¯•å’Œè„šæœ¬ç¼–å†™ã€‚

### AI/LLM é›†æˆ
é€šè¿‡æ ‡å‡†åŒ–çš„ MCP å·¥å…·ä½¿ AI ç³»ç»Ÿèƒ½å¤Ÿä¸ç½‘é¡µåº”ç”¨äº¤äº’ã€‚

### å¼€å‘å·¥å…·
åˆ©ç”¨å®æ—¶æµè§ˆå™¨è®¿é—®èƒ½åŠ›æ„å»ºè‡ªå®šä¹‰å¼€å‘å·¥å…·å’Œæ‰©å±•ã€‚

### æµè§ˆå™¨è°ƒè¯•
é€šè¿‡å®æ—¶æœåŠ¡å™¨é€šä¿¡è°ƒè¯•å’Œæ£€æŸ¥ç½‘é¡µåº”ç”¨ã€‚

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Web åº”ç”¨æµè§ˆå™¨                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è™šæ‹Ÿæ¨¡å—: devpilot-client          â”‚   â”‚
â”‚  â”‚  - WebSocket è¿æ¥                   â”‚   â”‚
â”‚  â”‚  - RPC å¤„ç†å‡½æ•°                     â”‚   â”‚
â”‚  â”‚  - æ’ä»¶å®¢æˆ·ç«¯æ¨¡å—                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â–²                    â–²           â”‚
â”‚           â”‚ WebSocket          â”‚ RPC       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â–¼                    â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    å¼€å‘æœåŠ¡å™¨ (Node.js)             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  WebSocket æœåŠ¡å™¨ (:3100)    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - å®¢æˆ·ç«¯ç®¡ç†                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - RPC è·¯ç”±                  â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  MCP æœåŠ¡å™¨ (:3101)          â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - å·¥å…·æ³¨å†Œ                  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - å·¥å…·è°ƒç”¨                  â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  æ’ä»¶ç³»ç»Ÿ                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - DOM æ£€æŸ¥å™¨                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - è‡ªå®šä¹‰æ’ä»¶                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â–²                               â”‚
â”‚           â”‚ MCP åè®®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ LLM  â”‚      â”‚ AI å·¥å…·  â”‚
â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ’ä»¶å¼€å‘

åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶ï¼š

```ts
import type { DevpilotPlugin } from 'unplugin-devpilot';
import { defineMcpToolRegister, resolveClientModule } from 'unplugin-devpilot';
import { z } from 'zod';

export default {
  namespace: 'my-plugin',
  clientModule: resolveClientModule(import.meta.url, './client/index.mjs'),

  serverSetup(ctx) {
    return {
      // æœåŠ¡ç«¯ RPC æ–¹æ³•
      myServerMethod: (arg: string) => `Result: ${arg}`,
    };
  },

  mcpSetup(ctx) {
    return [
      defineMcpToolRegister(
        'my_tool',
        {
          title: 'æˆ‘çš„å·¥å…·',
          description: 'è‡ªå®šä¹‰ MCP å·¥å…·',
          inputSchema: z.object({
            param: z.string(),
          }),
        },
        async (params) => {
          // å·¥å…·å®ç°
          return {
            content: [{
              type: 'text' as const,
              text: `å·¥å…·ç»“æœ: ${params.param}`,
            }],
          };
        },
      ),
    ];
  },
} satisfies DevpilotPlugin;
```

## å¼€å‘

### å‰ç½®è¦æ±‚
- Node.js 20.19.0+
- pnpm (æ¨è)

### å®‰è£…ä¾èµ–
```bash
pnpm install
```

### æ„å»º
```bash
pnpm build
```

### å¼€å‘æ¨¡å¼
```bash
pnpm dev
```

### è¿è¡Œæµ‹è¯•
```bash
pnpm test
```

### ç±»å‹æ£€æŸ¥
```bash
pnpm typecheck
```

## é…ç½®

### ç«¯å£é…ç½®
```ts
Devpilot({
  wsPort: 3100, // WebSocket æœåŠ¡å™¨ç«¯å£
  mcpPort: 3101, // MCP æœåŠ¡å™¨ç«¯å£
  plugins: [/* ... */],
});
```

### æ’ä»¶é€‰é¡¹
æ¯ä¸ªæ’ä»¶å¯ä»¥æ ¹æ®å…¶å®ç°è¿›è¡Œé…ç½®ã€‚è¯·å‚è€ƒå„ä¸ªæ’ä»¶çš„æ–‡æ¡£ã€‚

## æ€§èƒ½

- **é›¶ç”Ÿäº§æˆæœ¬** - ä»…åœ¨å¼€å‘æ¨¡å¼è¿è¡Œ
- **æœ€å°å¼€é”€** - æ‡’åŠ è½½æ’ä»¶å®¢æˆ·ç«¯æ¨¡å—
- **é«˜æ•ˆé€šä¿¡** - äºŒè¿›åˆ¶ WebSocket æ¶ˆæ¯
- **Token ä¼˜åŒ–** - ä¸º LLM ä½¿ç”¨ä¼˜åŒ–çš„ç´§å‡‘ DOM å¿«ç…§

## æ•…éšœæ’é™¤

### WebSocket è¿æ¥å¤±è´¥
- ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ç«¯å£ 3100 æ˜¯å¦æœªè¢«é˜²ç«å¢™é˜»æ­¢
- éªŒè¯ `wsPort` é…ç½®æ˜¯å¦æ­£ç¡®

### MCP å·¥å…·ä¸å¯ç”¨
- ç¡®è®¤æ’ä»¶å·²åœ¨é…ç½®ä¸­æ³¨å†Œ
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ä¸­çš„æ’ä»¶åŠ è½½é”™è¯¯
- éªŒè¯ MCP æœåŠ¡å™¨æ˜¯å¦åœ¨ç«¯å£ 3101 ä¸Šè¿è¡Œ

### å®¢æˆ·ç«¯æœªæ‰¾åˆ°
- åˆ·æ–°æµè§ˆå™¨é¡µé¢ä»¥é‡æ–°è¿æ¥
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ä¸­çš„è¿æ¥é”™è¯¯
- ä½¿ç”¨ `get_layout` æˆ– `list_clients` å·¥å…·å‘ç°å¯ç”¨å®¢æˆ·ç«¯

## è®¸å¯è¯

MIT Â© 2025 [zcf0508](https://github.com/zcf0508)

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

## ç›¸å…³èµ„æº

- [GitHub ä»“åº“](https://github.com/zcf0508/unplugin-devpilot)
- [unplugin æ–‡æ¡£](https://github.com/unjs/unplugin)
- [Model Context Protocol](https://modelcontextprotocol.io)
